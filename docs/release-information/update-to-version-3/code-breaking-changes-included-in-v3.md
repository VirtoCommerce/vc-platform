# Breaking changes

There were major refactorings made in VirtoCommerce version 3.0. The changes mapping below should help you finding the right class, API or behavior in the updated codebase.

| V2 | V3 | Impact |
| --- | --- | --- |
| **vc-platform** |   |   |
| ISecurityService | Removed. Need to use [UserManager<>](https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.identity.usermanager-1?view=aspnetcore-3.1) from ASP.NET Core  Identity instead.  [Link to code example](https://github.com/VirtoCommerce/vc-platform/blob/release/3.0.0/src/VirtoCommerce.Platform.Web/Controllers/Api/SecurityController.cs) | Low |
| IRoleManagementService | Removed. Need to use [RoleManager<>](https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.identity.rolemanager-1?view=aspnetcore-3.1) from ASP.NET Core  Identity instead.  [Link to code example](https://github.com/VirtoCommerce/vc-platform/blob/4657cb472a77a07d0267c6f87c553a9b745c0071/src/VirtoCommerce.Platform.Web/Controllers/Api/SecurityController.cs#L212) | Low |
| ConfigurationHelper | Removed. Now, for all env configuration need to use [ASP .NET Core Configuration](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?view=aspnetcore-3.1) [Link to code example](https://github.com/VirtoCommerce/vc-platform/blob/11ef321f8b464875568aad06cd00b33333245a75/src/VirtoCommerce.Platform.Assets.FileSystem/FileSystemBlobProvider.cs#L23) | Low |
| ISettingsManager.GetValue | GetValue method moved to [SettingsExtension](https://github.com/VirtoCommerce/vc-platform/blob/release/3.0.0/src/VirtoCommerce.Platform.Core/Settings/SettingsExtension.cs) and now load setting values only from db [Link to code example](https://github.com/VirtoCommerce/vc-platform/blob/11ef321f8b464875568aad06cd00b33333245a75/src/VirtoCommerce.Platform.Web/Controllers/Api/ModulesController.cs#L281), before it tried to load a setting value from env configuration first| High |
| EFRepositoryBase | Renamed to [DbContextRepositoryBase](https://github.com/VirtoCommerce/vc-platform/blob/release/3.0.0/src/VirtoCommerce.Platform.Data/Infrastructure/DbContextRepositoryBase.cs) and now not derived from DbContext and received DbContext as an argument of ctor. [Link to code example](https://github.com/VirtoCommerce/vc-platform/blob/release/3.0.0/src/VirtoCommerce.Platform.Data/Repositories/PlatformRepository.cs) | Low |
| RepositoryExtension.DisableChangesTracking | Has no effect. Need to use AsNoTracking(). [Tracking vs. No-Tracking Queries](https://docs.microsoft.com/en-us/ef/core/querying/tracking) and [Link to code example](https://github.com/VirtoCommerce/vc-platform/blob/11ef321f8b464875568aad06cd00b33333245a75/src/VirtoCommerce.Platform.Data/DynamicProperties/DynamicPropertySearchService.cs#L72) | High |
| AuditableInterceptor | Removed. All types inherited from `AuditableEntity` are automatically update their audit fields when save. You have to inherit your `DbContext` from `DbContextWithTriggers`. The magic happens here [ApplicationBuilderExtensions.cs](https://github.com/VirtoCommerce/vc-platform/blob/release/3.0.0/src/VirtoCommerce.Platform.Data/Extensions/ApplicationBuilderExtensions.cs) and [Link to code example](https://github.com/VirtoCommerce/vc-platform/blob/release/3.0.0/src/VirtoCommerce.Platform.Data/Repositories/PlatformDbContext.cs#L7)  | Medium |
| EntityPrimaryKeyGeneratorInterceptor | Removed. Now is using [EF Core - Value generated on add or update](https://docs.microsoft.com/en-us/ef/core/modeling/generated-properties?tabs=data-annotations#value-generated-on-add) and  [Link to code example](https://github.com/VirtoCommerce/vc-platform/blob/11ef321f8b464875568aad06cd00b33333245a75/src/VirtoCommerce.Platform.Data/Repositories/PlatformDbContext.cs#L23) | High |
| ChangeLogInterceptor | Removed.  Need to use domain event handlers for explicit log changes. [Link to code example](https://github.com/VirtoCommerce/vc-module-catalog/blob/release/3.0.0/src/VirtoCommerce.CatalogModule.Data/Handlers/LogChangesChangedEventHandler.cs) | High |
| ICacheManager<object> | Removed. Need to use IPlatformMemoryCache instead. [Link to code example](https://github.com/VirtoCommerce/vc-platform/blob/release/3.0.0/src/VirtoCommerce.Platform.Data/Settings/SettingsManager.cs#L91) | High |
| IDynamicPropertyService | Reworked. Divided into these abstractions [IDynamicPropertyService](https://github.com/VirtoCommerce/vc-platform/blob/release/3.0.0/src/VirtoCommerce.Platform.Core/DynamicProperties/IDynamicPropertyService.cs), [IDynamicPropertyRegistrar](https://github.com/VirtoCommerce/vc-platform/blob/release/3.0.0/src/VirtoCommerce.Platform.Core/DynamicProperties/IDynamicPropertyRegistrar.cs), [IDynamicPropertyDictionaryItemsService](https://github.com/VirtoCommerce/vc-platform/blob/release/3.0.0/src/VirtoCommerce.Platform.Core/DynamicProperties/IDynamicPropertyDictionaryItemsSearchService.cs), [IDynamicPropertyDictionaryItemsSearchService](https://github.com/VirtoCommerce/vc-platform/blob/release/3.0.0/src/VirtoCommerce.Platform.Core/DynamicProperties/IDynamicPropertySearchService.cs).Also, have made the significant changes with persistent infrastructure  [Link to docs and code sample](https://github.com/VirtoCommerce/vc-platform/blob/release/3.0.0/docs/Dynamic-Property.md) | Medium |
|Implicit dynamic properties declaration | Changed to explicit registration by `IDynamicPropertyRegistrar`. [See code example](https://github.com/VirtoCommerce/vc-module-order/blob/5b48aa15cfd7afa7be741bf7eedaaf021a738560/src/VirtoCommerce.OrdersModule.Web/Module.cs#L73) |High|
| IChangeLogService | Divided into two [IChangeLogService.cs](https://github.com/VirtoCommerce/vc-platform/blob/release/3.0.0/src/VirtoCommerce.Platform.Core/ChangeLog/IChangeLogService.cs) and [IChangeLogSearchService.cs](https://github.com/VirtoCommerce/vc-platform/blob/release/3.0.0/src/VirtoCommerce.Platform.Core/ChangeLog/IChangeLogSearchService.cs) | High |
| IExpressionSerializer |  Removed. The XML serialized expressions no longer used and are replaced with  serialized as json and run as managed code predicates.    [Link to code sample](https://github.com/VirtoCommerce/vc-module-marketing/blob/release/3.0.0/src/VirtoCommerce.MarketingModule.Core/Model/Promotions/Conditions/CartConditions/ConditionAtNumItemsOfCategoryAreInCart.cs) | Low |
| INotificationManager | Moved into separate module. [vc-module-notification](https://github.com/VirtoCommerce/vc-module-notification). (TODO: documentation) | Medium |
| IModule | The all methods signatures were changed. [IModule.cs](https://github.com/VirtoCommerce/vc-platform/blob/release/3.0.0/src/VirtoCommerce.Platform.Core/Modularity/IModule.cs) | High |
| module.manifest | The settings and permissions declarations were removed from `module.manifest` and are now declared in the code [PlatformConstants](https://github.com/VirtoCommerce/vc-platform/blob/release/3.0.0/src/VirtoCommerce.Platform.Core/PlatformConstants.cs) | High |
|Implicit settings  declaration|Changed to explicit registration by `ISettingsRegistrar`. [See code example](https://github.com/VirtoCommerce/vc-module-order/blob/5b48aa15cfd7afa7be741bf7eedaaf021a738560/src/VirtoCommerce.OrdersModule.Web/Module.cs#L80)|High|
|Implicit permissions  declaration|Changed to explicit registration by `IPermissionsRegistrar`. [See code example](https://github.com/VirtoCommerce/vc-module-order/blob/5b48aa15cfd7afa7be741bf7eedaaf021a738560/src/VirtoCommerce.OrdersModule.Web/Module.cs#L84)|High|
| **vc-module-core** |   |  |
| VirtoCommerce.Domain.Cart namespace | Moved to  [vc-module-cart](https://github.com/VirtoCommerce/vc-module-cart/) module | Medium |
| VirtoCommerce.Domain.Catalog namespace |  Moved to [vc-module-catalog](https://github.com/VirtoCommerce/vc-module-catalog/blob/release/3.0.0/src/VirtoCommerce.CatalogModule.Data/Handlers/LogChangesChangedEventHandler.cs) | Medium |
| VirtoCommerce.Domain.Customer namespace | Moved to [vc-module-customer](https://github.com/VirtoCommerce/vc-module-customer) module | Medium |
| VirtoCommerce.Domain.Inventory namespace | Moved to [vc-module-inventory](https://github.com/VirtoCommerce/vc-module-inventory) module | Medium |
| VirtoCommerce.Domain.Marketing namespace | Moved to [vc-module-marketing](https://github.com/VirtoCommerce/vc-module-marketing/blob/release/3.0.0/src/VirtoCommerce.MarketingModule.Core/Model/Promotions/Conditions/CartConditions/ConditionAtNumItemsOfCategoryAreInCart.cs) module | Medium |
| VirtoCommerce.Domain.Order namespace | Moved to [vc-module-order](https://github.com/VirtoCommerce/vc-module-order) module | Medium |
| VirtoCommerce.Domain.Payment namespace | Moved to [vc-module-payment](https://github.com/VirtoCommerce/vc-module-payment)  module| Medium |
| VirtoCommerce.Domain.Pricing namespace | Moved to [vc-module-pricing](https://github.com/VirtoCommerce/vc-module-pricing) module | Medium |
| VirtoCommerce.Domain.Search namespace | Moved to [vc-module-search](https://github.com/VirtoCommerce/vc-module-search) module | Medium |
| VirtoCommerce.Domain.Shipping namespace | Moved to [vc-module-shipping](https://github.com/VirtoCommerce/vc-module-shipping) module | Medium |
| VirtoCommerce.Domain.Store namespace | Moved to [vc-module-store](https://github.com/VirtoCommerce/vc-module-store) module | Medium |
| VirtoCommerce.Domain.Tax  namespace | Moved to [vc-module-tax](https://github.com/VirtoCommerce/vc-module-tax) module | Medium |
| VirtoCommerce.Domain.Commerce.Model.Search.GenericSearchResult | Moved to VirtoCommerce.Platform.Core [GenericSearchResult.cs](https://github.com/VirtoCommerce/vc-platform/blob/release/3.0.0/src/VirtoCommerce.Platform.Core/Common/GenericSearchResult.cs) | High |
| VirtoCommerce.Domain.Commerce.Model.Search.SearchCriteriaBase | Moved to VirtoCommerce.Platform.Core[SearchCriteriaBase.cs](https://github.com/VirtoCommerce/vc-platform/blob/release/3.0.0/src/VirtoCommerce.Platform.Core/Common/SearchCriteriaBase.cs) | High |
| VirtoCommerce.Domain.Commerce.Model.Currency | Moved to [VirtoCommerce.CoreModule.Core.Currency](https://github.com/VirtoCommerce/vc-module-core/blob/release/3.0.0/src/VirtoCommerce.CoreModule.Core/Currency/Currency.cs) namespace | Medium |
| VirtoCommerce.Domain.Commerce.Model.PackageType | Moved to [VirtoCommerce.CoreModule.Core.Package](https://github.com/VirtoCommerce/vc-module-core/tree/release/3.0.0/src/VirtoCommerce.CoreModule.Core/Package) namespace | Medium |
| VirtoCommerce.Domain.Commerce.Model.ISeoSupport | Moved to [VirtoCommerce.CoreModule.Core.Seo](https://github.com/VirtoCommerce/vc-module-core/tree/release/3.0.0/src/VirtoCommerce.CoreModule.Core/Seo) namespace | Medium |
| VirtoCommerce.Domain.Commerce.Model.ITaxable | Moved to [VirtoCommerce.CoreModule.Core.Tax](https://github.com/VirtoCommerce/vc-module-core/tree/release/3.0.0/src/VirtoCommerce.CoreModule.Core/Tax) namespace | Medium |
| VirtoCommerce.Domain.Commerce.Services.ICommerceService | Removed.  Distributed responsibility between these services[ICurrencyService.cs](https://github.com/VirtoCommerce/vc-module-core/blob/release/3.0.0/src/VirtoCommerce.CoreModule.Core/Currency/ICurrencyService.cs) vc-module-core.  Work with Seo data moved  into each  module level  [vc-catalog module SeoInfoEntity.cs](https://github.com/VirtoCommerce/vc-module-catalog/blob/release/3.0.0/src/VirtoCommerce.CatalogModule.Data/Model/SeoInfoEntity.cs), [vc-store-module SeoInfoEntity.cs](https://github.com/VirtoCommerce/vc-module-store/blob/release/3.0.0/src/VirtoCommerce.StoreModule.Data/Model/SeoInfoEntity.cs), etc Packages moved into [IPackageTypesService.cs](https://github.com/VirtoCommerce/vc-module-core/blob/release/3.0.0/src/VirtoCommerce.CoreModule.Core/Package/IPackageTypesService.cs) vc-module-core | Medium |
| **vc-module-catalog** |   |  |
| VirtoCommerce.Domain.Catalog.ICatalogSearchService| Removed.  For database search need to use the following services: [IListEntrySearchService](https://github.com/VirtoCommerce/vc-module-catalog/blob/release/3.0.0/src/VirtoCommerce.CatalogModule.Core/Search/IListEntrySearchService.cs) for search products and categories. [IProductSearchService](https://github.com/VirtoCommerce/vc-module-catalog/blob/release/3.0.0/src/VirtoCommerce.CatalogModule.Core/Search/IProductSearchService.cs) for products search. [ICategorySearchService](https://github.com/VirtoCommerce/vc-module-catalog/blob/release/3.0.0/src/VirtoCommerce.CatalogModule.Core/Search/ICategorySearchService.cs) for categories search  | Medium |
|VirtoCommerce.CatalogModule.Data.Search.ICategorySearchService |Removed. For categories indexed search need to use [ICategoryIndexedSearchService](https://github.com/VirtoCommerce/vc-module-catalog/blob/release/3.0.0/src/VirtoCommerce.CatalogModule.Core/Search/Indexed/ICategoryIndexedSearchService.cs)|Medium|
|VirtoCommerce.CatalogModule.Data.Search.IProductSearchService |Removed. For products indexed search need to use [IProductIndexedSearchService](https://github.com/VirtoCommerce/vc-module-catalog/blob/release/3.0.0/src/VirtoCommerce.CatalogModule.Core/Search/Indexed/IProductIndexedSearchService.cs)|Medium|
| **vc-store-module** |   |  |
| Store.PaymentMethods| Removed. To search payment methods need to use [IPaymentMethodsSearchService](https://github.com/VirtoCommerce/vc-module-payment/blob/release/3.0.0/src/VirtoCommerce.Payment.Core/Services/IPaymentMethodsSearchService.cs) and [IPaymentMethodsService](https://github.com/VirtoCommerce/vc-module-payment/blob/release/3.0.0/src/VirtoCommerce.Payment.Core/Services/IPaymentMethodsService.cs) for CRUD operations. See [DefaultManualPaymentMethod](https://github.com/VirtoCommerce/vc-module-payment/blob/release/3.0.0/src/VirtoCommerce.Payment.Data/DefaultManualPaymentMethod.cs) as example|  Medium |
|Store.ShippingMethods|Removed. To search shipping methods need to use [IShippingMethodsSearchService](https://github.com/VirtoCommerce/vc-module-shipping/blob/release/3.0.0/src/VirtoCommerce.ShippingModule.Core/Services/IShippingMethodsSearchService.cs) and [IShippingMethodsService](https://github.com/VirtoCommerce/vc-module-shipping/blob/release/3.0.0/src/VirtoCommerce.ShippingModule.Core/Services/IShippingMethodsService.cs) for CRUD operations. See [FixedRateShippingMethod](https://github.com/VirtoCommerce/vc-module-shipping/blob/release/3.0.0/src/VirtoCommerce.ShippingModule.Data/FixedRateShippingMethod.cs) as example|Medium|
|Store.TaxProviders|Removed. To search tax providers need to use [ITaxProviderSearchService](https://github.com/VirtoCommerce/vc-module-tax/blob/release/3.0.0/src/VirtoCommerce.TaxModule.Core/Services/ITaxProviderSearchService.cs) and [ITaxProviderService](https://github.com/VirtoCommerce/vc-module-tax/blob/release/3.0.0/src/VirtoCommerce.TaxModule.Core/Services/ITaxProviderService.cs) for CRUD operations. See [FixedRateTaxProvider](https://github.com/VirtoCommerce/vc-module-tax/blob/release/3.0.0/src/VirtoCommerce.TaxModule.Data/Provider/FixedRateTaxProvider.cs) as example|Medium|
|IStoreService.SearchStores| Moved to [IStoreSearchService](https://github.com/VirtoCommerce/vc-module-store/blob/release/3.0.0/src/VirtoCommerce.StoreModule.Core/Services/IStoreSearchService.cs)|Low|
| **vc-module-cache** |  Module removed. Now all cache functionality is implemented in each module level. [See code example](https://github.com/VirtoCommerce/vc-module-store/blob/569604b373fa36f4f3c6ec16b20dbd2223f6585a/src/VirtoCommerce.StoreModule.Data/Services/StoreService.cs#L43)  | Low |
| **vc-module-dynamic-expressions** | Module removed. ||
| dynamic expressions and templates | All dynamic expression templates expressions are moved into [vc-module-core/Scripts/dynamicConditions/all-templates.html](https://github.com/VirtoCommerce/vc-module-core/blob/release/3.0.0/src/VirtoCommerce.CoreModule.Web/Scripts/dynamicConditions/all-templates.html) and [vc-module-marketing/Scripts/dynamicConditions/all-templates.html](https://github.com/VirtoCommerce/vc-module-marketing/blob/release/3.0.0/src/VirtoCommerce.MarketingModule.Web/Scripts/dynamicConditions/templates.html). All dynamic expressions logic are moved into  [VirtoCommerce.MarketingModule.Core/Model/Promotions/Conditions](https://github.com/VirtoCommerce/vc-module-marketing/tree/release/3.0.0/src/VirtoCommerce.MarketingModule.Core/Model/Promotions/Conditions) | Low |
|IMarketingExtensionManager|Replaced with [PromotionConditionAndRewardTreePrototype](https://github.com/VirtoCommerce/vc-module-marketing/blob/release/3.0.0/src/VirtoCommerce.MarketingModule.Core/Model/Promotions/PromotionConditionAndRewardTreePrototype.cs) (TODO: Docs how to extend  expression tree)|Low|
|IPricingExtensionManager|Replaced with [PriceConditionTreePrototype](https://github.com/VirtoCommerce/vc-module-pricing/blob/release/3.0.0/src/VirtoCommerce.PricingModule.Core/Model/Conditions/PriceConditionTreePrototype.cs) (TODO: Docs how to extend  expression tree)|Low|
